[tox]
env_list = py310,py311,py312,py313
skip_missing_interpreters = true

[testenv]
description = Run tests with {basepython}
deps =
    pytest>=7.4
    pytest-cov>=4.1
commands =
    pytest {posargs}

[testenv:lint]
description = Run linters
deps =
    ruff>=0.5
    mypy>=1.10
    types-PyYAML>=6.0.12.20240917
    types-requests>=2.31.0.10
commands =
    ruff check src tests
    mypy src

[testenv:format]
description = Format code
deps =
    ruff>=0.5
commands =
    ruff format src tests

[testenv:playwright]
description = Run Playwright browser integration tests (headless)
passenv =
    PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD
    CI
deps =
    pytest>=7.4
    pytest-cov>=4.1
    playwright>=1.40
    pytest-playwright>=0.4.4
commands_pre =
    python -c "import os; os.environ.get('PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD') or __import__('playwright.sync_api').install()"
commands =
    pytest tests/playwright {posargs} -v --browser chromium --cov=pwa_forge --cov-append --cov-report=term-missing

[testenv:coverage-all]
description = Run all tests (unit + Playwright) with combined coverage
passenv =
    PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD
    CI
deps =
    pytest>=7.4
    pytest-cov>=4.1
    playwright>=1.40
    pytest-playwright>=0.4.4
commands_pre =
    python -c "import os; os.environ.get('PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD') or __import__('playwright.sync_api').install()"
commands =
    pytest -v --cov=pwa_forge --cov-report=html --cov-report=term-missing
